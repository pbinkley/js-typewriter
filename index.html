<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@pabinkley" />
  <meta name="twitter:title" content="js-typewriter" />
  <meta name="twitter:image" content="https://pbinkley.github.io/js-typewriter/assets/type.jpg" />
  <meta name="twitter:image:alt" content="Typewriter letters showing upper and lower case" />
  
  <meta property="og:title" content="js-typewriter" />
  <meta property="og:image" content="https://pbinkley.github.io/js-typewriter/assets/type.jpg" />
  <meta property="og:url" content="https://pbinkley.github.io/js-typewriter/" />

  <title>Typewriter</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" 
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" 
    crossorigin="anonymous"></script>
  <style>
    @font-face {
      font-family: 'TT2020StyleE';
      src: url('assets/TT2020StyleE-Regular.woff2') format('woff2'); 
    }
    body {
      font-family: 'TT2020StyleE', 'Courier', sans-serif;
      font-variant-ligatures: none;
    }
    #demo {
      height: 100px; 
      width: 100%; 
      border: 1px solid black; 
      font-size: large;
       overflow-y: scroll;
    }
    .credits {
      font-size: small;
    }
    #head img {
      float: left;
      margin-right: 2em;
      margin-bottom: 30px;
    }
    #posthead {
      clear: both;
    }
  </style>
</head>
<body>
  <div id="head">
    <img src="assets/type-small.jpg"/>
    <h1>Typewriter</h1>
  </div>
  <p>(There's sound. This won't make much sense without sound.)</p>
  
  <p id="posthead">Enter some text:</p>
  
  <form id="theText" onSubmit="return typeIt(document.getElementById('source').value)">
    <textarea id="source" rows="4" cols="50"></textarea>
    <br/><br/>
    <input type="submit" value="Type it">
  </form>
  
  <p id="demo"></p>
  
  <button onClick="return typeRSS('https://rss.nytimes.com/services/xml/rss/nyt/World.xml')">Type NYT headlines</button>
  
  <audio id="key1" preload="auto">
    <source src="sounds/monotraum-key-1.mp3" type="audio/mpeg">
    <source src="sounds/monotraum-key-1.wav" type="audio/wav">
    Your browser does not support the audio element.
  </audio>
  <audio id="key2" preload="auto">
    <source src="sounds/monotraum-key-2.mp3" type="audio/mpeg">
    <source src="sounds/monotraum-key-2.wav" type="audio/wav">
    Your browser does not support the audio element.
  </audio>
  <audio id="space" preload="auto">
    <source src="sounds/monotraum-space.mp3" type="audio/mpeg">
    <source src="sounds/monotraum-space.wav" type="audio/wav">
    Your browser does not support the audio element.
  </audio>
  <audio id="shiftkey" preload="auto">
    <source src="sounds/monotraum-shift.mp3" type="audio/mpeg">
    <source src="sounds/monotraum-shift.wav" type="audio/wav">
    Your browser does not support the audio element.
  </audio>
  <audio id="tscroll" preload="auto">
    <source src="sounds/scroll.mp3" type="audio/mpeg">
    <source src="sounds/scroll.wav" type="audio/wav">
    Your browser does not support the audio element.
  </audio>
  <audio id="endpage" preload="auto">
    <source src="sounds/345955__knufds__typewriter-bell-carriage-reset.mp3" type="audio/mpeg">
    <source src="sounds/345955__knufds__typewriter-bell-carriage-reset.wav" type="audio/wav">
    Your browser does not support the audio element.
  </audio>
  
  <script>
    var i = 0;
    var txt;
    
    var speed = 100;
    var duration;
    var sound;

    var shifters = ['!', '"', '#', '$', '%', '_', '&', '\'', '(', ')',
                    '*', '+', 'Â¼', ':', '@', '?']
    var nbsp = '\xa0';
    var output = document.getElementById("demo");

    var currentSounds = []

    function cleanChars(t) {
      return t
        .replace(/[\u2018\u2019\u275B\u275C]/g, "'")
        .replace(/[\u201C\u201D\u201F\u275D\u275E]/g, '"')
        .replace(/\u2014/g, '--')
        .replace(/\u2013/g, '-');
    }

    function typeIt(t) {
      txt = cleanChars(t);
      document.getElementById("demo").innerHTML = "";
      currentSounds = []
      scrollin();
      return false;
    }
    
    function scrollin() {
      i = 0;
      sound = key1;
      tscroll.play();
      setTimeout(typeWriter, 3500);
      return false;
    }
    
    function typechar(ch) {
      if (ch.match(/\n/)) {
        output.innerHTML += '<br />';
      } else if (ch === nbsp) {
        output.innerHTML += '&nbsp;';
      } else {
        output.innerHTML += ch;
      }
      output.scrollTop = output.scrollHeight;
      return false;
    }
    
    function typeWriter() {
      if (i < txt.length) {
        ch = txt.charAt(i);
           
        if (ch === ' ' || ch === nbsp) {
          sound = space;
          duration = 216;
        } else if ((ch >= 'A' && ch <= 'Z') || shifters.includes(ch)) {
          sound = shiftkey;
          //duration = 792;
          duration = 500;
        } else if (ch.match(/\n/)) {
          sound = endpage;
          duration = 2920;
        } else {
          sound = (Math.random() > 0.5) ? key1 : key2;
          duration = speed + Math.floor(Math.random() * 120);
        }

        temp = sound.cloneNode(true);
        temp.play();
        currentSounds.push(temp);

        setTimeout(typechar, 100, ch);
        setTimeout(typeWriter, duration);

        i++;

        // delete finished sound from beginningo of queue
        while (currentSounds[0].duration > 0 && !currentSounds[0].paused){
          currentSounds.shift();
        }
      }
      else {
        endpage.play();
      }
      return false;
    }
    
    function typeRSS(feed) {	
      $.ajax(feed, {
        accepts:{
          xml:"application/rss+xml"
        },
        dataType:"xml",
        success:function(data) {
          //Credit: http://stackoverflow.com/questions/10943544/how-to-parse-an-rss-feed-using-javascript
          txt = ''
          
          $(data).find("item").each(function () { // or "item" or whatever suits your feed
            var el = $(this);
            console.log("------------------------");
            console.log("title      : " + el.find("title").text());
            console.log("link       : " + el.find("link").text());
            console.log("description: " + el.find("description").text());
            
            txt += el.find("title").text();
            txt += "\n" + nbsp + nbsp + nbsp;
            txt += el.find("description").text(); 
            txt += "\n\n"
          });
          typeIt(txt);
      
    
        }	
      });
      return false;
    }
  </script>
  
  <p class="credits">
    Typewriter font: <a href="https://ctrlcctrlv.github.io/TT2020/">TT2020</a> 
    used under the <a href="https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=OFL#5667e9e4">SIL Open Font License</a>, 
    version 1.1.
  </p>
  
  <p class="credits">
    Sounds: from <a href="https://freesound.org/people/monotraum/sounds/434027/">monotraum</a>,
    <a href="https://freesound.org/people/blukotek/sounds/246057/">blukotek</a> and 
    <a href="https://freesound.org/people/knufds/sounds/345955/">knufds</a>
    on <a href="https:freesound.org">Freesound</a>, all <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.
  </p>
  
  <p class="credits">
    Code: <a href="https://github.com/pbinkley/js-typewriter/">pbinkley/js-typewriter</a>
  </p>
</body>
</html>

